"use strict";class e{constructor(e){this.negative=!1,this.number="."===e?"0.":e}t(e){if("."===e){if(/\./.test(this.number))return 1}else"0"===this.number&&(this.number="");return this.number+=e,0}i(e){return 2}o(e){return"±"===e?(this.negative=!this.negative,0):2}u(){return 4}p(){return 5}h(){return 2}l(){return!(this.number.length>1)||(this.number=this.number.substr(0,this.number.length-1),!1)}m(e){e.push('<span class="number">',this.negative?"-":"",this.number,"</span>")}k(){return 6}evaluate(e,...t){const n=parseFloat(this.number);return this.negative?-n:n}g(){return e.v}S(){return[this.negative,this.number]}O(e){this.negative=e[0],this.number=e[1]}clone(){const t=new e("0");return t.negative=this.negative,t.number=this.number,t}}e.v="n";class t{constructor(e){this.I=e}t(e){return 2}i(e){return this.I=e,0}o(e){return 1}u(){return 2}p(){return 2}h(){return 1}m(e){e.push('<span class="operator">',this.I,"</span>")}k(){switch(this.I){case"+":case"−":return 2;case"×":case"÷":return 3;case"^":case"E":return 4}}evaluate(e,...t){const[n,r]=t;switch(this.I){case"+":return n+r;case"−":return n-r;case"×":return n*r;case"÷":return n/r;case"^":return Math.pow(n,r);case"E":return n*Math.pow(10,r)}}g(){return t.v}S(){return this.I}O(e){this.I=e}clone(){return new t(this.I)}}t.v="b";class n{constructor(e){this.I=e}t(e){return 1}i(e){return 2}o(e){if(e===this.I)switch(e){case"±":case"1/𝘹":return 6}return 2}u(){return 1}p(){return 1}h(){return 2}m(e){e.push('<span class="operator">',this.I,"</span>")}k(){return 5}evaluate(e,...t){const n=t[0];switch(this.I){case"1/𝘹":return 1/n;case"√":return Math.sqrt(n);case"±":return-n}}g(){return n.v}S(){return this.I}O(e){this.I=e}clone(){return new n(this.I)}}n.v="u";class r{constructor(e){this.T=e}t(e){return 1}i(e){return 2}o(e){return 2}u(){return 1}p(){return 1}h(){return 2}m(e){e.push('<span class="parenthesis">(</span>');for(const t of this.T)t.m(e);e.push('<span class="parenthesis">)</span>')}k(){return 6}evaluate(e,...t){const n=[];for(const t of function(e){const t=[],n=[];for(const r of e){const e=r.k();switch(e){case 6:case 5:t.push(r);break;default:let s;for(;s=n.pop();){if(!(s.k()>=e)){n.push(s);break}t.push(s)}n.push(r)}}return t.push(...n.reverse()),t}(this.T))switch(t.k()){case 6:n.push(t.evaluate(e));break;case 5:n[n.length-1]=t.evaluate(e,n[n.length-1]);break;default:const r=n.splice(n.length-2,2);n.push(t.evaluate(e,...r))}return n[0]}g(){return r.v}S(){return this.T.map(o)}O(e){this.T=e.map(c)}clone(){return new r(this.T.map((e=>e.clone())))}}r.v="g";class s{constructor(e){this.I=e}t(e){return 4}i(e){return 2}o(e){return 2}u(){return 4}p(){return 5}h(){return 2}m(e){e.push('<span class="symbol">',this.I,"</span>")}k(){return 6}evaluate(e,...t){switch(this.I){case"Ans":return e.history.length>0?e.history[e.history.length-1].C:0}}g(){return s.v}S(){return this.I}O(e){this.I=e}clone(){return new s(this.I)}}s.v="s";class a{t(e){return 2}i(e){return 1}o(e){return 1}u(){return 2}p(){return 2}h(){return 1}m(e){e.push('<span class="parenthesis">(</span>')}k(){return 1}evaluate(e,...t){throw new Error("should never evaluate OpenToken")}g(){return a.v}S(){return null}O(e){}clone(){return this}}a.v="o";class i{t(e){return 2}i(e){return 3}o(e){return 3}u(){return 2}p(){return 2}h(){return 1}m(e){e.push('<span class="eq">=</span>')}k(){return 0}evaluate(e,...t){throw new Error("should never evaluate EqToken")}g(){return i.v}S(){return null}O(e){}clone(){return this}}function o(e){return[e.g(),e.S()]}function c(o){let c;switch(o[0]){case e.v:c=new e("0");break;case t.v:c=new t("+");break;case n.v:c=new n("±");break;case r.v:c=new r([]);break;case s.v:c=new s("Ans");break;case a.v:c=new a;break;case i.v:c=new i;break;default:throw new Error(`cannot serialize token from ${o}`)}return c.O(o[1]),c}i.v="e";const u=new Intl.NumberFormat("en-US",{D:!0,U:20});function p(e){return document.getElementById(e)}document.body.addEventListener("touchmove",(e=>{"none"===p("history-sheet").style.display&&e.preventDefault()}),{passive:!1});let h=new class{constructor(){this.T=[]}B(e,t){switch(e){case 2:this.T.push(t);break;case 3:this.T.push(new s("Ans"),t);break;case 4:this.T[this.T.length-1]=t;break;case 5:this.T.splice(this.T.length-1,0,t);break;case 6:this.T.pop()}}A(e,t){if(0===this.T.length)return e;const n=this.T[this.T.length-1],r=t(n);return n instanceof i&&1!==r&&(this.T=[]),r}t(t){const n=this.A(2,(e=>e.t(t)));this.B(n,new e(t))}i(e){const n=this.A(3,(t=>t.i(e)));this.B(n,new t(e))}o(e){const t=this.A(3,(t=>t.o(e)));this.B(t,new n(e))}u(e){const t=this.A(2,(e=>e.u()));this.B(t,new s(e))}p(){const e=this.A(2,(e=>e.p()));this.B(e,new a)}h(){switch(this.A(1,(e=>e.h()))){case 1:return!1;case 2:for(let e=this.T.length-1;e>=0;e--)if(this.T[e]instanceof a){const t=new r(this.T.slice(e+1));return this.T.splice(e,this.T.length-e,t),!0}return!1;default:throw new Error("unknown action for appending `)`")}}l(){let t=this.T.pop();t instanceof e?t.l()||this.T.push(t):t instanceof r&&this.T.push(new a,...t.T)}m(e){for(const t of this.T)t.m(e)}q(){let t=this.T.length,n=t-1;e:for(;n>=0;){const e=this.T[n].k();switch(e){case 6:break e;case 0:t--,n=0;break e;case 5:n--;break;case 1:n--,t--;break;default:for(t--;n>0;){if(this.T[n-1].k()<e)break e;n--}}}return n<0&&(n=0),n>=t?[new e("0")]:this.T.slice(n,t)}$(){if(2===this.A(1,(e=>e.h()))){for(;this.h(););this.T.push(new i)}}J(){return this.T.length>0&&this.T[this.T.length-1]instanceof i}},l=new class{constructor(){const e=JSON.parse(localStorage.getItem("hI")||"[]"),t=[],n=[];for(const r of e){const e=JSON.parse(localStorage.getItem(`hV${r}`)||"null");if(e instanceof Array){const[s,a]=e,i=s.map(c);t.push(r),n.push({M:i,C:a})}}this.N=t,this.history=n,this.V=0}F(e,t){let n=0;if(this.N.length>0&&(n=this.N[this.N.length-1]+1),this.N.length>=64){const e=this.N.shift();this.history.shift(),localStorage.removeItem(`hV${e}`)}this.N.push(n),this.history.push({M:e,C:t}),localStorage.setItem(`hV${n}`,JSON.stringify([e.map(o),t])),localStorage.setItem("hI",JSON.stringify(this.N))}G(e){const[t]=this.N.splice(e,1);this.history.splice(e,1),localStorage.removeItem(`hV${t}`),localStorage.setItem("hI",JSON.stringify(this.N))}};function d(e){const t=Math.abs(e);return 0===t||t>=1e-6&&t<1e16?u.format(e):e.toExponential()}function f(e){const t=[];h.m(t),p("display-formula").innerHTML=t.join("");const n=new r(h.q()).evaluate(l);l.V=n,h.J()&&"eq"===e.target.id&&l.F(h.T.map((e=>e.clone())),n),function(e){const t=p("display-result"),n=d(e),r=t.clientWidth,s=Math.max(r,function(e){let t=0;for(const n of e)switch(n){case",":break;case".":t+=15.57;break;case"-":t+=18.65;break;case"+":t+=32.7;break;default:t+=31.15}return t}(n));t.style.transform=`scaleX(${r/s})`,t.innerHTML=n.replace(/,/g,'<span class="zero-width-comma">,</span>')}(n)}function w(e){const t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy",!1),t.remove()}function y(){for(const e of document.getElementsByName("history-item")){const t=e;if(t.checked)return+t.value}return-1}function b(){p("history-sheet").style.display="none"}function m(){const e=[];for(let t=l.history.length-1;t>=0;t--){const n=l.history[t],r=""+t;e.push('<div class="history-screen"><input type="radio" value="',r,'" id="history-item-',r,'" name="history-item"><label for="history-item-',r,'"><div class="formula">');for(const t of n.M)t.m(e);e.push('</div><div class="result">',d(n.C),"</div></label></div>")}p("history-content").innerHTML=e.join("")}p("buttons").onclick=f,window.onresize=f,p("n-0").onclick=()=>h.t("0"),p("n-1").onclick=()=>h.t("1"),p("n-2").onclick=()=>h.t("2"),p("n-3").onclick=()=>h.t("3"),p("n-4").onclick=()=>h.t("4"),p("n-5").onclick=()=>h.t("5"),p("n-6").onclick=()=>h.t("6"),p("n-7").onclick=()=>h.t("7"),p("n-8").onclick=()=>h.t("8"),p("n-9").onclick=()=>h.t("9"),p("dot").onclick=()=>h.t("."),p("neg").onclick=()=>h.o("±"),p("add").onclick=()=>h.i("+"),p("sub").onclick=()=>h.i("−"),p("mul").onclick=()=>h.i("×"),p("div").onclick=()=>h.i("÷"),p("pow").onclick=()=>h.i("^"),p("ee").onclick=()=>h.i("E"),p("reciprocal").onclick=()=>h.o("1/𝘹"),p("sqrt").onclick=()=>h.o("√"),p("ans").onclick=()=>h.u("Ans"),p("open").onclick=()=>h.p(),p("close").onclick=()=>h.h(),p("backspace").onclick=()=>h.l(),p("eq").onclick=()=>h.$(),p("ac").onclick=e=>{h.T=[],f(e)},p("copy").onclick=()=>{w(""+l.V)},p("history").onclick=()=>{m(),p("history-sheet").style.display="block"},p("use-history-formula").onclick=e=>{const t=y();if(t>=0){const n=l.history[t];h.T=n.M.map((e=>e.clone())),f(e),b()}},p("copy-history-value").onclick=()=>{const e=y();if(e>=0){w(""+l.history[e].C)}},p("delete-history").onclick=()=>{const e=y();e>=0&&(l.G(e),m())},p("close-history").onclick=b;